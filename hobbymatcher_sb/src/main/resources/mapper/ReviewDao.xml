<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hobbymatcher.dao.ReviewDao">
    <select id="listReviewByTypeAndId"
            resultType="com.hobbymatcher.entity.Review">
		SELECT review.*, 
			user.first_name as by_user_first, 
			user.last_name as by_user_last,
			user.photo_id as by_user_photo_id
		FROM review
		JOIN user on user.id = review.by_user_id
		WHERE owner_type = #{ownerType}
		  AND owner_id = #{ownerId}
		ORDER BY review.on_datetime
	</select>

    <insert id="addReview" useGeneratedKeys="true" keyProperty="id">
		insert into review (content, owner_type, owner_id, by_user_id, on_datetime)
		values (#{content}, #{ownerType}, #{ownerId}, #{byUserId}, #{onDatetime})
	</insert>

    <delete id="deleteReview">
		DELETE
		FROM review
		WHERE id = #{id}
	</delete>
</mapper>